---
description: å…³äºé¡¹ç›®ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œå¯ä»¥æ ¹æ®ç¼–ç éœ€è¦åŠæ›´æ–°è¿‡ç¨‹ï¼ŒåŒæ—¶ä¿®æ”¹æœ¬æ–‡æ¡£
globs: 
alwaysApply: false
---
# å®¶è£…AIé¡¹ç›®å¼€å‘è§„åˆ™ä¸ä»£ç å¯¼å›¾

## ğŸ—ï¸ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºCloudflareå…¨æ ˆçš„å®¶è£…AIèµ„è®¯å¹³å°ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ã€‚

### æŠ€æœ¯æ ˆ

#### å‰ç«¯ (Frontend)
- **æ¡†æ¶:** Next.js 15.3.1 + React 19.0.0
- **æ ·å¼:** TailwindCSS 4.0
- **ç¼–è¾‘å™¨:** TipTap 2.12.0 (å¯Œæ–‡æœ¬ç¼–è¾‘å™¨)
- **è¯­è¨€:** TypeScript 5.0
- **éƒ¨ç½²:** Cloudflare Pages

#### åç«¯ (Backend)  
- **æ¡†æ¶:** Hono 4.7.8 (Cloudflare Workers)
- **éªŒè¯:** Zod 3.24.4 + Hono Zod Validator
- **è®¤è¯:** JWT
- **å­˜å‚¨:** AWS SDK S3å®¢æˆ·ç«¯ (R2å…¼å®¹)
- **è¯­è¨€:** TypeScript
- **éƒ¨ç½²:** Cloudflare Workers

#### æ•°æ®å­˜å‚¨
- **ä¸»æ•°æ®åº“:** Cloudflare D1 (SQLite)
- **æ–‡ä»¶å­˜å‚¨:** Cloudflare R2 (S3å…¼å®¹)
- **ç¼“å­˜:** Cloudflare KV
- **ç¯å¢ƒå˜é‡ç®¡ç†:** Cloudflare Workers Secrets

---

## ğŸ“ ç›®å‰é¡¹ç›®ç›®å½•ç»“æ„

```
jiazhuangai2VS/
â”œâ”€â”€ .git/                          # Gitç‰ˆæœ¬æ§åˆ¶
â”œâ”€â”€ .roo/                          # é¡¹ç›®è§„åˆ™å’Œé…ç½®
â”‚   â””â”€â”€ rules-code/
â”‚       â”œâ”€â”€ rules.md              # åŸºç¡€æŠ€æœ¯è§„åˆ™
â”‚       â””â”€â”€ project-rules.md      # æœ¬æ–‡ä»¶
â”œâ”€â”€ frontend/                      # Next.jså‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/           # ç®¡ç†åå°é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ articles/        # æ–‡ç« ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ categories/      # åˆ†ç±»é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ login/           # ç™»å½•é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ profile/         # ç”¨æˆ·èµ„æ–™é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ register/        # æ³¨å†Œé¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # å…¨å±€å¸ƒå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # é¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ globals.css      # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ components/          # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ context/             # React Context
â”‚   â”‚   â””â”€â”€ types/              # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ public/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json            # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ next.config.ts          # Next.jsé…ç½®
â”‚   â”œâ”€â”€ tailwind.config.ts      # TailwindCSSé…ç½®
â”‚   â””â”€â”€ tsconfig.json           # TypeScripté…ç½®
â”œâ”€â”€ backend/                       # Cloudflare Workersåç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ routes/              # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts         # è®¤è¯è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ articles.ts     # æ–‡ç« ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ categories.ts   # åˆ†ç±»ç®¡ç†è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ r2Routes.ts     # æ–‡ä»¶ä¸Šä¼ è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ types/             # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ models.ts          # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ index.ts           # ä¸»å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ schema.sql             # æ•°æ®åº“ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ wrangler.toml          # Workersé…ç½®
â”‚   â”œâ”€â”€ package.json           # åç«¯ä¾èµ–é…ç½®
â”‚   â””â”€â”€ tsconfig.json          # TypeScripté…ç½®
â”œâ”€â”€ docs/                         # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ wrangler.toml                # ä¸»é¡¹ç›®Cloudflareé…ç½®
â”œâ”€â”€ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
â””â”€â”€ .nvmrc                       # Node.jsç‰ˆæœ¬é”å®š
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### ç›®å‰D1æ•°æ®åº“è¡¨ç»“æ„ï¼ˆå¯ä»¥æ ¹æ®éœ€è¦å˜æ›´ï¼‰

1. **users** - ç”¨æˆ·è¡¨ (ç®¡ç†å‘˜)
   - id (ä¸»é”®)
   - username (ç”¨æˆ·åï¼Œå”¯ä¸€)
   - password (å“ˆå¸Œå¯†ç )
   - role (è§’è‰²ï¼Œé»˜è®¤'user')
   - created_at (åˆ›å»ºæ—¶é—´)

2. **categories** - åˆ†ç±»è¡¨
   - id (ä¸»é”®)
   - name (åˆ†ç±»åï¼Œå”¯ä¸€)
   - slug (URLå‹å¥½æ ‡è¯†ï¼Œå”¯ä¸€)
   - description (æè¿°)
   - created_at, updated_at (æ—¶é—´æˆ³)

3. **articles** - æ–‡ç« è¡¨
   - id (ä¸»é”®)
   - title (æ ‡é¢˜)
   - slug (URLå‹å¥½æ ‡è¯†ï¼Œå”¯ä¸€)
   - content_type (å†…å®¹ç±»å‹ï¼Œé»˜è®¤markdown)
   - content (æ–‡ç« å†…å®¹)
   - category_id (åˆ†ç±»IDï¼Œå¤–é”®)
   - parent_id (çˆ¶æ–‡ç« IDï¼Œæ”¯æŒæ ‘å½¢ç»“æ„)
   - display_date (æ˜¾ç¤ºæ—¥æœŸï¼Œç”¨äºæ’åº)
   - created_at, updated_at (æ—¶é—´æˆ³)

4. **article_attachments** - æ–‡ç« é™„ä»¶è¡¨
   - id (ä¸»é”®)
   - article_id (æ–‡ç« IDï¼Œå¤–é”®)
   - file_type (æ–‡ä»¶ç±»å‹ï¼šimage/video/documentç­‰)
   - file_url (R2å­˜å‚¨URL)
   - filename (åŸå§‹æ–‡ä»¶å)
   - description (æè¿°/Altæ–‡æœ¬)
   - created_at (åˆ›å»ºæ—¶é—´)

---

## ğŸ”Œ APIæ¥å£è®¾è®¡

### è®¤è¯æ¥å£ (/api/auth)
- POST /login - ç”¨æˆ·ç™»å½•
- POST /register - ç”¨æˆ·æ³¨å†Œ
- GET /profile - è·å–ç”¨æˆ·ä¿¡æ¯

### åˆ†ç±»ç®¡ç† (/api/categories)
- GET / - è·å–æ‰€æœ‰åˆ†ç±»
- POST / - åˆ›å»ºåˆ†ç±»
- GET /:id - è·å–å•ä¸ªåˆ†ç±»
- PUT /:id - æ›´æ–°åˆ†ç±»
- DELETE /:id - åˆ é™¤åˆ†ç±»

### æ–‡ç« ç®¡ç† (/api/articles)
- GET / - è·å–æ–‡ç« åˆ—è¡¨
- POST / - åˆ›å»ºæ–‡ç« 
- GET /:id - è·å–å•ç¯‡æ–‡ç« 
- PUT /:id - æ›´æ–°æ–‡ç« 
- DELETE /:id - åˆ é™¤æ–‡ç« 

### æ–‡ä»¶ç®¡ç† (/api/r2)
- POST /upload - æ–‡ä»¶ä¸Šä¼ 
- GET /presigned-url - è·å–é¢„ç­¾åURL
- DELETE /file - åˆ é™¤æ–‡ä»¶

---

## ğŸ”§ ç¯å¢ƒé…ç½®

### Cloudflareèµ„æºé…ç½®
```toml
# KVå‘½åç©ºé—´
KV_NAMESPACE_ID = "a120d00a55da47e682ad94852b8ab4cb"
KV_NAMESPACE_NAME = "jiazhuangai"

# D1æ•°æ®åº“
D1_DATABASE_ID = "69c4b792-fca3-48f6-a280-1c9977ed1dee" 
D1_DATABASE_NAME = "jiazhuangai"

# R2å­˜å‚¨æ¡¶
R2_BUCKET_NAME = "jiazhuangai-files"
R2_ACCOUNT_ID = "319de3339b3b7ef960bd9ecb563f33dd"
R2_ACCESS_KEY_ID = "7522d5e5032c9356ddeb46bc6ef6cf05"
R2_SECRET_ACCESS_KEY = "e38877dcd6cb3a4d7d1041197c88fe3d68c4630fa3fbbfda55892399f5c3f281"

# R2è®¿é—®åœ°å€
R2_PUBLIC_URL = "https://pub-3dc6a89ae11b4f2bb35597920365df2d.r2.dev"
```

### CORSé…ç½®
å…è®¸çš„å‰ç«¯åŸŸåï¼š
- `https://jiazhuangai2vs.pages.dev` (Pagesé»˜è®¤åŸŸå)
- `https://www.jiazhuangai.com` (è‡ªå®šä¹‰ä¸»åŸŸå)
- `http://localhost:3000` (æœ¬åœ°å¼€å‘)

---

## ğŸ“‹ å¼€å‘è§„èŒƒ

### ä»£ç ç»„ç»‡åŸåˆ™
1. **å‰ç«¯ç»„ä»¶åŒ–** - ä½¿ç”¨Reactç»„ä»¶åŒ–å¼€å‘ï¼Œç»„ä»¶èŒè´£å•ä¸€
2. **APIè®¾è®¡RESTful** - éµå¾ªREST APIè®¾è®¡åŸåˆ™
3. **ç±»å‹å®‰å…¨** - å…¨ç¨‹ä½¿ç”¨TypeScriptï¼Œå®šä¹‰å®Œæ•´çš„ç±»å‹
4. **é”™è¯¯å¤„ç†** - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
5. **å®‰å…¨è®¤è¯** - JWT Tokenè®¤è¯ï¼ŒCORSè·¨åŸŸæ§åˆ¶

### æ–‡ä»¶å‘½åè§„èŒƒ
- ç»„ä»¶æ–‡ä»¶: PascalCase (å¦‚ `ArticleCard.tsx`)
- é¡µé¢æ–‡ä»¶: kebab-case (å¦‚ `article-detail.tsx`)
- å·¥å…·å‡½æ•°: camelCase (å¦‚ `formatDate.ts`)
- å¸¸é‡æ–‡ä»¶: UPPER_SNAKE_CASE (å¦‚ `API_ENDPOINTS.ts`)

### Gitæäº¤è§„èŒƒ
- feat: æ–°åŠŸèƒ½
- fix: ä¿®å¤bug
- docs: æ–‡æ¡£æ›´æ–°
- style: ä»£ç æ ¼å¼è°ƒæ•´
- refactor: ä»£ç é‡æ„
- test: æµ‹è¯•ç›¸å…³
- chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### å‰ç«¯éƒ¨ç½² (Cloudflare Pages)
1. è¿æ¥Gitä»“åº“
2. è®¾ç½®æ„å»ºå‘½ä»¤: `cd frontend && npm run build`
3. è®¾ç½®è¾“å‡ºç›®å½•: `frontend/.next`
4. é…ç½®ç¯å¢ƒå˜é‡
5. è‡ªåŠ¨éƒ¨ç½²

### åç«¯éƒ¨ç½² (Cloudflare Workers)
1. ä½¿ç”¨Wrangler CLIéƒ¨ç½²
2. é…ç½®D1æ•°æ®åº“ç»‘å®š
3. é…ç½®R2å­˜å‚¨æ¡¶ç»‘å®š
4. é…ç½®KVå‘½åç©ºé—´ç»‘å®š
5. è®¾ç½®ç¯å¢ƒå˜é‡å’ŒSecrets

### æ•°æ®åº“è¿ç§»
1. ä½¿ç”¨wrangleræ‰§è¡Œschema.sql
2. åˆ›å»ºå¿…è¦çš„ç´¢å¼•
3. åˆå§‹åŒ–åŸºç¡€æ•°æ®

---

## ğŸ¯ é¡¹ç›®ç‰¹è‰²åŠŸèƒ½

1. **å¯Œæ–‡æœ¬ç¼–è¾‘å™¨** - åŸºäºTipTapçš„æ–‡ç« ç¼–è¾‘åŠŸèƒ½
2. **æ–‡ä»¶ä¸Šä¼ ** - R2å­˜å‚¨çš„å›¾ç‰‡/é™„ä»¶ç®¡ç†
3. **åˆ†ç±»ç®¡ç†** - å±‚çº§åˆ†ç±»ç³»ç»Ÿ
4. **æ ‘å½¢æ–‡ç« ** - æ”¯æŒçˆ¶å­å…³ç³»çš„æ–‡ç« ç»“æ„
5. **ç”¨æˆ·è®¤è¯** - JWT Tokenè®¤è¯ç³»ç»Ÿ
6. **å“åº”å¼è®¾è®¡** - TailwindCSSå“åº”å¼å¸ƒå±€

---

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

1. **Context7æœåŠ¡** - å¯ä»¥ä½¿ç”¨Context7è·å–åº“æ–‡æ¡£
2. **Cloudflare MCP** - å¯ä»¥ä½¿ç”¨Cloudflare MCPç®¡ç†äº‘èµ„æºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Wrangler CLI
3. **GitHub MCP** - å¯ä»¥ä½¿ç”¨GitHub MCPè¿›è¡Œä»£ç ç®¡ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨gitå‘½ä»¤
4. **Node.jsç‰ˆæœ¬** - é”å®šåœ¨18.18.0+
5. **è·¨åŸŸå¤„ç†** - ä¸¥æ ¼çš„CORSç­–ç•¥æ§åˆ¶
6. **å®‰å…¨è€ƒè™‘** - å¯†ç å“ˆå¸Œã€JWTè¿‡æœŸã€è¾“å…¥éªŒè¯
7. **æ€§èƒ½ä¼˜åŒ–** - æ•°æ®åº“ç´¢å¼•ã€CDNç¼“å­˜ã€å›¾ç‰‡å‹ç¼©

---

 