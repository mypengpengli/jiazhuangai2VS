---
description: 
globs: 
alwaysApply: true
---
# AI助手执行规则

## 1. R1 (总纲 - 隐含)

代码修改后的需要在终端运行的所有命令如NPM等等CMD命令之类的和git请你自动执行，修改完成最后帮我直接推送到我的main的仓库，不用我再询问和要求你推送。
助手的主要目标是协助用户完成编程、项目管理及相关技术任务。所有的任务，不需要向我询问，你需要全部自主运行即可。

所有操作应以用户需求为核心，力求准确、高效、安全。

## 2. R2 (计划与执行 - 对应原3R前半部分)

### 严格按计划执行
助手应严格按照既定计划的顺序执行每一步任务。

### 技术文档查阅
在进行任何编码步骤之前，可以使用 context7 的MCP查询相应的技术文档，确保方案的正确性和可行性。

### 编码规范

#### 详细注释与解释
代码中必须包含详细的注释和解释，说明代码逻辑、功能及重要变量的含义，以便AI自身及用户后续查询和排错。

#### 清晰命名
变量、函数、类、文件等应采用清晰、规范、有意义的命名，方便理解和回溯。

### 可以使用MCP
- 在进行数据库操作时，可以使用Cloudflare的MCP（Management Control Plane）查询或者运行。
- 在进行代码版本管理时，可以使用GitHub的MCP。

### 代码审查环节
每一阶段编码完成后，必须进行审查，确保：
- 未偏离整体计划目标。
- 采用了context7 MCP指导的最新正确技术栈和方法。
- 注释、命名等符合规范，便于AI排查错误和人工回溯。
- 数据库配套正确无误。

### 计划调整与迭代
- 若审查通过，未偏离计划，则在计划文档中标记该步骤为"已完成"，然后顺序执行下一步。
- 若审查发现偏离，需立即停止，重新审查是计划本身存在问题，还是当前步骤需要重新执行。

## 3. R3 (Cloudflare与Git操作细则 - 对应原3R后半部分)

### Cloudflare Worker更新
当后台代码（特别是Cloudflare Worker相关的代码）发生变更后，助手需要记得使用Wrangler CLI命令来更新Worker部署。

### 数据库与代码更新
优先使用Wrangler CLI命令来更新Cloudflare数据库（如D1），优先使用标准的Git命令来更新代码到GitHub仓库。

## 4. R4 (用户协作与信息记录 - 对应原4R)

### 清晰指令
当需要用户配合时（例如：打开特定网站输入账号密码、提供API密钥、设置密钥信息、配合测试等），助手必须提供清晰、具体、分步骤的操作指南。

### 便捷测试
要求用户配合测试时，应提供最方便用户的测试方法。助手自身能通过MCP或其他工具执行的验证步骤，不应要求用户手动执行代码或进行复杂操作。对用户的要求应通俗易懂、便于执行。

### 固定信息记录
所有固定的关键信息，如设置的密钥、API信息、账号详情、代码仓库地址及推送方式等，都必须新建并记录在一个名为"项目固定信息记录文件"（可根据实际情况命名，原"XX规则文件"）的专属文档中，以便助手和用户随时查阅和排查问题。

## 5. R5 (敏感信息管理与配置 - 对应原5R)

### 敏感信息隔离
API密钥、私有证书等敏感信息，必须保存到一个专门的、独立的文档中。

### Git忽略
该敏感信息文档严禁提交到Git仓库，必须将其路径添加到项目的.gitignore文件中。此文档仅在编程过程中由助手按需读取使用。

### Cloudflare Worker变量配置
对于Cloudflare Worker中使用的环境变量（如R2 Bucket名称、API Key等），必须全部通过Wrangler CLI的命令（如 `wrangler secret put <KEY>` 或在 `wrangler.toml` 中配置）进行设置和管理。避免用户在Cloudflare网页控制台手动输入配置，因为Worker更新时可能会导致这些手动设置的变量丢失。

## 6. R6 (问题解决策略 - 对应原6R)

### 最小改动原则
在遇到问题并需要解决时，助手应首先思考并尝试选择改动最小、影响范围最小的解决方案。

### 大型重构前的评估
如果初步判断解决方案可能需要大规模修改代码（涉及多个文件或核心逻辑），则应：

1. **优先检查数据库：** 确认数据库中是否已存在所需字段或数据结构，避免不必要的代码重构。
2. **再次查阅文档：** 重新使用context7及其他网络资源查询相关技术文档和最佳实践，寻找更优解。
3. **利用MCP查询：** 对于涉及GitHub、Cloudflare Pages、Cloudflare数据库等平台的问题，可优先使用其各自的MCP查询所需信息以辅助决策。

## 7. R7 (自动化命令执行 - 对应原7R)

### 直接执行相关命令
助手可以直接执行所有与数据库操作（如Cloudflare D1）及Cloudflare Worker管理相关的Wrangler CLI命令。用户已安装Wrangler CLI，不需要用户手动执行这些命令。

## 8. R8 (代码结构维护 - 对应原最后一句)

### 更新代码导图
每当项目中新增文件时，助手需要及时更新项目的"代码导图"或相关结构文档，以保持项目结构的清晰和最新。

---


